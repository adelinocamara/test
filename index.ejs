<%
  const LOCAL_PAGE = Object.freeze({
    title: LOCAL_STRINGS.profile,
    description: {
      en: '',
      es: ''
    },
    keywords: {
      en: '',
      es: ''
    },
    robots: 'index, follow',
    canonical: '',
    og_url: '',
    og_site_name: {
      en: '',
      es: ''
    },
    og_image: '',
    twitter_card: {
      en: '',
      es: ''
    },
    stylesheets: [
      "/profile/res/src/assets/css/light/components/list-group.css",
      "/profile/res/src/assets/css/light/users/user-profile.css",
      "/profile/res/src/plugins/src/splide/splide.min.css",
      "/profile/res/src/plugins/css/light/splide/custom-splide.min.css",
      "/profile/res/src/plugins/css/dark/splide/custom-splide.min.css"
    ]
  })
%>
<%- include('./header-page-logged.ejs', {
  LOCAL_PAGE
}) -%>
<!--  BEGIN *** CONTENT ***  -->
  
  <div class="row layout-spacing ">
    <!-- Content -->
    <div class="col-xl-5 col-lg-12 col-md-12 col-sm-12 layout-top-spacing">
      <div class="user-profile layout-spacing">
        <div class="widget-content widget-content-area modern-profile-compact">
          <div class="profile-banner-compact">
            <svg class="banner-wave" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320">
              <path fill="#ffffff" fill-opacity="1" d="M0,192L30,186.7C60,181,120,171,180,144C240,117,300,75,360,69.3C420,64,480,96,540,133.3C600,171,660,213,720,208C780,203,840,149,900,138.7C960,128,1020,160,1080,165.3C1140,171,1200,149,1260,144C1320,139,1380,149,1410,154.7L1440,160L1440,320L1410,320C1380,320,1320,320,1260,320C1200,320,1140,320,1080,320C1020,320,960,320,900,320C840,320,780,320,720,320C660,320,600,320,540,320C480,320,420,320,360,320C300,320,240,320,180,320C120,320,60,320,30,320L0,320Z"></path>
            </svg>
          </div>
          <div class="modern-profile-content-compact">
            <div class="user-profile-header-compact">
              <div class="profile-avatar-3d-compact">
                <img src="/profile/res/src/assets/img/users/<%=req.session.active_user.photo%>" alt="Foto de perfil">
              </div>
              
              <div class="user-info-3d-compact">
                <h3 class="user-name-3d-compact"><%=req.session.active_user.last_name%> <%=req.session.active_user.first_name%></h3>
                <span class="user-role-3d-compact"><%=req.session.active_user.occupation%></span>
                
                <div class="user-quick-actions-compact">
                  <button class="action-btn-compact message">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-message-circle"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>
                  </button>
                  <button class="action-btn-compact connect">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-user-plus"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="8.5" cy="7" r="4"></circle><line x1="20" y1="8" x2="20" y2="14"></line><line x1="23" y1="11" x2="17" y2="11"></line></svg>
                  </button>
                  <a href="./user-account-settings.html" class="action-btn-compact edit">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-3"><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></svg>
                  </a>
                </div>
              </div>
            </div>
            
            <div class="profile-stats-3d-compact">
              <div class="stat-card-compact">
                <div class="stat-icon-compact blue">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-award"><circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline></svg>
                </div>
                <div class="stat-info-compact">
                  <h4 class="stat-number-compact">125</h4>
                  <span class="stat-title-compact">Logros</span>
                </div>
              </div>
              
              <div class="stat-card-compact">
                <div class="stat-icon-compact purple">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-briefcase"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg>
                </div>
                <div class="stat-info-compact">
                  <h4 class="stat-number-compact">42</h4>
                  <span class="stat-title-compact">Proyectos</span>
                </div>
              </div>
              
              <div class="stat-card-compact">
                <div class="stat-icon-compact green">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-users"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                </div>
                <div class="stat-info-compact">
                  <h4 class="stat-number-compact">874</h4>
                  <span class="stat-title-compact">Seguidores</span>
                </div>
              </div>
            </div>
            
            <div class="modern-info-section-compact">
              <h5 class="section-title-compact">Información de Contacto</h5>
              
              <div class="info-container-compact">
                <div class="info-item-compact">
                  <div class="info-icon-compact">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                  </div>
                  <div class="info-details-compact">
                    <h6 class="info-title-compact">Fecha de Nacimiento</h6>
                    <p class="info-content-compact"><%=req.session.active_user.birthdate_formatted%></p>
                  </div>
                </div>
                
                <div class="info-item-compact">
                  <div class="info-icon-compact">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-map-pin"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                  </div>
                  <div class="info-details-compact">
                    <h6 class="info-title-compact">Ubicación</h6>
                    <p class="info-content-compact">
                      <%=req.session.active_user.address_1%> <%=req.session.active_user.address_2%><br>
                      <%=req.session.active_user.city%>, <%=req.session.active_user.state%> <%=req.session.active_user.zip_code%><br>
                      <span class="flag-wrapper-compact">
                        <img src="/profile/res/src/assets/img/flag/<%=req.session.active_user.img_flag%>" width="16px" title="flag" alt="flag">
                        <%=req.session.active_user.country%>
                      </span>
                    </p>
                  </div>
                </div>
                
                <div class="info-item-compact">
                  <div class="info-icon-compact">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                  </div>
                  <div class="info-details-compact">
                    <h6 class="info-title-compact">Correo Electrónico</h6>
                    <p class="info-content-compact">
                      <a href="mailto:<%=req.session.active_user.email%>"><%=req.session.active_user.email%></a>
                    </p>
                  </div>
                </div>
                
                <div class="info-item-compact">
                  <div class="info-icon-compact">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-phone"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                  </div>
                  <div class="info-details-compact">
                    <h6 class="info-title-compact">Teléfono</h6>
                    <p class="info-content-compact"><%=req.session.active_user.cell_phone%></p>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="modern-social-section-compact">
              <h5 class="section-title-compact">Redes Sociales</h5>
              
              <div class="social-links-3d-compact">
                <a href="javascript:void(0);" class="social-link-compact twitter">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg>
                </a>
                <a href="javascript:void(0);" class="social-link-compact linkedin">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-linkedin"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg>
                </a>
                <a href="javascript:void(0);" class="social-link-compact github">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>
                </a>
                <a href="javascript:void(0);" class="social-link-compact dribble">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-dribbble"><circle cx="12" cy="12" r="10"></circle><path d="M8.56 2.75c4.37 6.03 6.02 9.42 8.03 17.72m2.54-15.38c-3.72 4.35-8.94 5.66-16.88 5.85m19.5 1.9c-3.5-.93-6.63-.82-8.94 0-2.58.92-5.01 2.86-7.44 6.32"></path></svg>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-7 col-lg-12 col-md-12 col-sm-12 layout-top-spacing">
      <div class="usr-tasks ">
          <div class="widget-content widget-content-area">
              <h3 class="">Task</h3>
              <div class="table-responsive">
                  <table class="table table-bordered">
                      <thead>
                          <tr>
                              <th>Projects</th>
                              <th>Progress</th>
                              <th>Task Done</th>
                              <th class="text-center">Time</th>
                          </tr>
                      </thead>
                      <tbody>
                          <tr>
                              <td>Figma Design</td>
                              <td>
                                  <div class="progress br-30">
                                      <div class="progress-bar br-30 bg-danger" role="progressbar" style="width: 29.56%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                                  </div>
                              </td>
                              <td><p class="text-danger">29.56%</p></td>
                              <td class="text-center">
                                  <p>2 mins ago</p>
                              </td>
                          </tr>

                          <tr>
                              <td>Vue Migration</td>
                              <td>
                                  <div class="progress br-30">
                                      <div class="progress-bar br-30 bg-info" role="progressbar" style="width: 50%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                                  </div>
                              </td>
                              <td><p class="text-success">50%</p></td>
                              <td class="text-center">
                                  <p>4 hrs ago</p>
                              </td>
                          </tr>
                          
                          <tr>
                              <td>Flutter App</td>
                              <td>                                                    
                                  <div class="progress br-30">
                                      <div class="progress-bar br-30 bg-warning" role="progressbar" style="width: 39%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                                  </div>
                              </td>
                              <td><p class="text-danger">39%</p></td>
                              <td class="text-center">
                                  <p>a min ago</p>
                              </td>
                          </tr>
                          <tr>
                              <td>API Integration</td>
                              <td>                                                    
                                  <div class="progress br-30">
                                      <div class="progress-bar br-30 bg-success" role="progressbar" style="width: 78.03%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                                  </div>
                              </td>
                              <td><p class="text-success">78.03%</p></td>
                              <td class="text-center">
                                  <p>2 weeks ago</p>
                              </td>
                          </tr>
                          
                          <tr>
                              <td>Blog Update</td>
                              <td>                                                    
                                  <div class="progress br-30">
                                      <div class="progress-bar br-30 bg-secondary" role="progressbar" style="width: 100%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                                  </div>
                              </td>
                              <td><p class="text-success">100%</p></td>
                              <td class="text-center">
                                  <p>18 hrs ago</p>
                              </td>
                          </tr>

                          <tr>
                              <td>Landing Page</td>
                              <td>                                                    
                                  <div class="progress br-30">
                                      <div class="progress-bar br-30 bg-danger" role="progressbar" style="width: 19.15%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                                  </div>
                              </td>
                              <td><p class="text-danger">19.15%</p></td>
                              <td class="text-center">
                                  <p>5 days ago</p>
                              </td>
                          </tr>

                          <tr>
                              <td>Shopify Dev</td>
                              <td>                                                    
                                  <div class="progress br-30">
                                      <div class="progress-bar br-30 bg-info" role="progressbar" style="width: 60.55%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                                  </div>
                              </td>
                              <td><p class="text-success">60.55%</p></td>
                              <td class="text-center">
                                  <p>8 days ago</p>
                              </td>
                          </tr>

                      </tbody>
                  </table>
              </div>
          </div>
      </div>
    </div>
  </div>
  <div class="row">
    
  </div>
  <!-- Modal de Termómetro Emocional -->
  <div class="modal fade" id="emotionModal" tabindex="-1" aria-labelledby="emotionModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title w-100 text-center" id="emotionModalLabel">
            <b><%=req.session.active_user.first_name%>,</b> <%=LOCAL_STRINGS.emotion_how_feeling_today[language]%>
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
            <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
          </button>
        </div>
        <div class="modal-body">
          <div class="emotion-header d-flex align-items-center justify-content-center mb-3">
            <div class="emotion-face me-3" id="emotionFace">
              <div class="avatar avatar-xl" id="faceContent">
                <img id="faceImg" class="rounded-circle" src="/profile/res/src/assets/img/emotions/" title="">
              </div>
            </div>
            <div class="emotion-info ">
              <h4 class="emotion-title ml-4 mb-1" id="emotionTitle"><%=LOCAL_STRINGS.emotion_feel_normal[language]%></h4>
              <p class="emotion-description mb-0" id="emotionDescription">
                <%=LOCAL_STRINGS.emotion_select_meter_how_feel[language]%>
              </p>
            </div>
          </div>
          <!-- Termómetro visual mejorado -->
          <div class="emotion-meter" id="emotionMeter">
            <div class="meter-indicator" id="meterIndicator"></div>
            <div class="meter-scale">
              <span><%=LOCAL_STRINGS.emotion_meter_excellent[language]%></span>
              <span><%=LOCAL_STRINGS.emotion_meter_good[language]%></span>
              <span><%=LOCAL_STRINGS.emotion_meter_normal[language]%></span>
              <span><%=LOCAL_STRINGS.emotion_meter_regular[language]%></span>
              <span><%=LOCAL_STRINGS.emotion_meter_bad[language]%></span>
            </div>
          </div>
          <!-- Slider alternativo -->
          <div class="slider-container">
            <label class="intensity-label"><%=LOCAL_STRINGS.intensity_level[language]%>:</label>
            <input type="range" class="emotion-slider" id="emotionSlider" min="1" max="100" value="50" step="1">
          </div>
          <div id="div_emotions" class="row">
            <div id="splider_MultipleSlider" class="col-lg-12 col-md-12 layout-spacing">
              <div class="statbox widget box box-shadow">
                <div class="widget-header">
                  <div class="row">
                    <div class="col-xl-12 col-md-12 col-sm-12 col-12">
                      <h4 id="h4title">Multiple Slides</h4>
                    </div>
                  </div>
                </div>
                <div class="widget-content widget-content-area">
                  <div class="position-relative">
                    <div class="container" style="max-width: 700px">
                      <div class="splide-multiple">
                        <div class="splide__track">
                          <ul id="ul_listemotions" class="splide__list">
                            <li class="splide__slide">
                              <img alt="slider-image" class="img-fluid" src="/profile/res/src/assets/img/emotions/1_gozo_male.png">
                            </li>
                            <li class="splide__slide">
                              <img alt="slider-image" class="img-fluid" src="/profile/res/src/assets/img/emotions/2_paz_male.png">
                            </li>
                            <li class="splide__slide">
                              <img alt="slider-image" class="img-fluid" src="/profile/res/src/assets/img/emotions/3_gratitud_male.png">
                            </li>
                            <li class="splide__slide">
                              <img alt="slider-image" class="img-fluid" src="/profile/res/src/assets/img/emotions/11_contemplativo_female.png">
                            </li>
                            <li class="splide__slide">
                              <img alt="slider-image" class="img-fluid" src="/profile/res/src/assets/img/emotions/12_expectante_female.png">
                            </li>
                            <li class="splide__slide">
                              <img alt="slider-image" class="img-fluid" src="/profile/res/src/assets/img/emotions/15_nostalgico_female.png">
                            </li>
                            <li class="splide__slide">
                              <img alt="slider-image" class="img-fluid" src="/profile/res/src/assets/img/emotions/17_ansiedad_female.png">
                            </li>
                            <li class="splide__slide">
                              <img alt="slider-image" class="img-fluid" src="/profile/res/src/assets/img/emotions/24_ira_male.png">
                            </li>
                            <li class="splide__slide">
                              <img alt="slider-image" class="img-fluid" src="/profile/res/src/assets/img/emotions/30_verguenza_male.png">
                            </li>
                            <li class="splide__slide">
                              <img alt="slider-image" class="img-fluid" src="/profile/res/src/assets/img/emotions/product-1.jpg">
                            </li>
                            <li class="splide__slide">
                              <img alt="slider-image" class="img-fluid" src="/profile/res/src/assets/img/emotions/product-2.jpg">
                            </li>
                            <li class="splide__slide">
                              <img alt="slider-image" class="img-fluid" src="/profile/res/src/assets/img/emotions/product-3.jpg">
                            </li>
                          </ul>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- Pregunta de oración -->
          <div class="prayer-section">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="prayerRequest">
              <label class="form-check-label" for="prayerRequest">
                <%=LOCAL_STRINGS.emotion_would_like_pray_for[language]%>
              </label>
            </div>
            <div id="prayerTextarea" class="mt-3" style="display: none;">
              <textarea class="form-control" id="prayerDescription"
                        placeholder="<%=LOCAL_STRINGS.emotion_share_why_to_pray[language]%>"
                        rows="3"></textarea>
              <div class="form-check mt-2">
                <input class="form-check-input" type="checkbox" id="anonymousRequest">
                <label class="form-check-label" for="anonymousRequest">
                  <%=LOCAL_STRINGS.anonymous_request[language]%>
                </label>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer border-0 pt-0 justify-content-center">
          <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">
            <%=LOCAL_STRINGS.emotion_not_now[language]%>
          </button>
          <button type="button" class="btn btn-submit" id="submitEmotion">
            <%=LOCAL_STRINGS.emotion_send_state[language]%>
          </button>
        </div>
      </div>
    </div>
  </div>
<!--  END *** CONTENT ***  -->
<%- include('./footer-page-logged.ejs'); -%>
<script src="/profile/res/src/plugins/src/splide/splide.min.js"></script>
<!--  BEGIN *** SCRIPTS ***  -->
  <script>
    const div_emotions = document.getElementById('div_emotions');
    const h4title = document.getElementById('h4title');

    class EmotionMeter {
      constructor() {
        this.slider = document.getElementById('emotionSlider');
        this.face = document.getElementById('emotionFace');
        this.faceContent = document.getElementById('faceContent');
        this.faceImg = document.getElementById('faceImg');
        this.title = document.getElementById('emotionTitle');
        this.description = document.getElementById('emotionDescription');
        this.indicator = document.getElementById('meterIndicator');
        this.meter = document.getElementById('emotionMeter');
        this.prayerCheck = document.getElementById('prayerRequest');
        this.prayerTextarea = document.getElementById('prayerTextarea');
        this.submitBtn = document.getElementById('submitEmotion');
        this.emotions = {
          happy: {
            face: '😊',
            src: '/profile/res/src/assets/img/emotions/positive_male.png',
            title: '<%=LOCAL_STRINGS.emotion_feel_good[language]%>',
            description: '<%=LOCAL_STRINGS.emotion_feel_good_desc[language]%>',
            bgClass: 'emotion-happy',
            range: [1, 35]  // Área verde/izquierda del slider
          },
          neutral: {
            face: '😐',
            src: '/profile/res/src/assets/img/emotions/reflective_male.png',
            title: '<%=LOCAL_STRINGS.emotion_feel_normal[language]%>',
            description: '<%=LOCAL_STRINGS.emotion_feel_normal_desc[language]%>',
            bgClass: 'emotion-neutral',
            range: [36, 65]  // Área amarilla/centro del slider
          },
          sad: {
            face: '😢',
            src: '/profile/res/src/assets/img/emotions/negative_male.png',
            title: '<%=LOCAL_STRINGS.emotion_feel_bad[language]%>',
            description: '<%=LOCAL_STRINGS.emotion_feel_bad_desc[language]%>',
            bgClass: 'emotion-sad',
            range: [66, 100]  // Área roja/derecha del slider
          }
        };
        this.init();
      }
      init() {
        // Event listeners
        this.slider.addEventListener('input', () => this.updateEmotion());
        this.meter.addEventListener('click', (e) => this.handleMeterClick(e));
        this.prayerCheck.addEventListener('change', () => this.togglePrayerTextarea());
        this.submitBtn.addEventListener('click', () => this.submitEmotion());
        // Initial state
        this.updateEmotion();
      }
      updateEmotion() {
        const value = parseInt(this.slider.value);
        let currentEmotion = null;
        // Determine current emotion
        for (const [key, emotion] of Object.entries(this.emotions)) {
          if (value >= emotion.range[0] && value <= emotion.range[1]) {
            currentEmotion = emotion;
            break;
          }
        }
        if (currentEmotion) {
          // Update face with animation
          console.log('current emotion type:')
          // this.faceContent.style.transform = 'scale(0.8)';
          // setTimeout(() => {
          //   this.faceContent.textContent = currentEmotion.face;
          //   this.faceContent.style.transform = 'scale(1)';
          // }, 150);
          // this.face.className = `emotion-face ${currentEmotion.bgClass}`;
          // Update text
          this.title.textContent = currentEmotion.title;
          this.description.textContent = currentEmotion.description;
          // Update meter indicator
          // Mapeo: valor 1-35 (verde/bien) -> ángulo -90° a -18° (izquierda)
          // valor 36-65 (amarillo/normal) -> ángulo -18° a +18° (centro)
          // valor 66-100 (rojo/mal) -> ángulo +18° a +90° (derecha)
          let angle;
          if (value <= 35) {
              // Área verde (bien) - izquierda del medidor
              console.log('HAPPY');
              h4title.textContent = '<%=LOCAL_STRINGS.emotion_very_good[language]%>';
              this.faceImg.src = `/profile/res/src/assets/img/emotions/positive_male.png`;
              angle = -90 + ((value - 1) / 34) * 72;
          } else if (value <= 65) {
              // Área amarilla (normal) - centro del medidor
              console.log('NEUTRAL');
              h4title.textContent = '<%=LOCAL_STRINGS.emotion_normal[language]%>';
              this.faceImg.src = `/profile/res/src/assets/img/emotions/reflective_male.png`;
              angle = -18 + ((value - 36) / 29) * 36;
          } else {
              // Área roja (mal) - derecha del medidor
              console.log('SAD');
              h4title.textContent = '<%=LOCAL_STRINGS.emotion_very_badly[language]%>';
              this.faceImg.src = `/profile/res/src/assets/img/emotions/negative_male.png`;
              angle = 18 + ((value - 66) / 34) * 72;
          }
          this.indicator.style.transform = `translate(-50%, 0) rotate(${angle}deg)`;
          // Update title color
          //this.title.style.color = this.getEmotionColor(currentEmotion.bgClass);
        }
      }
      getEmotionColor(bgClass) {
        switch(bgClass) {
          case 'emotion-happy': return '#16a34a';
          case 'emotion-neutral': return '#d97706';
          case 'emotion-sad': return '#dc2626';
          default: return '#1f2937';
        }
      }
      handleMeterClick(e) {
        const rect = this.meter.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.bottom - 28; // Ajustar por el padding del medidor
        const x = e.clientX - centerX;
        const y = centerY - e.clientY;
        if (y > 0) { // Solo si el clic está en la parte superior
          let angle = Math.atan2(x, y) * (180 / Math.PI);
          angle = Math.max(-90, Math.min(90, angle)); // Limitar al semicírculo
          // Convertir ángulo a valor del slider
          let value;
          if (angle <= -18) {
            // Área izquierda (verde/bien)
            value = 1 + Math.round(((angle + 90) / 72) * 34);
          } else if (angle <= 18) {
            // Área centro (amarillo/normal)
            value = 36 + Math.round(((angle + 18) / 36) * 29);
          } else {
            // Área derecha (rojo/mal)
            value = 66 + Math.round(((angle - 18) / 72) * 34);
          }
          this.slider.value = Math.max(1, Math.min(100, value));
          this.updateEmotion();
        }
      }
      togglePrayerTextarea() {
        const display = this.prayerCheck.checked ? 'block' : 'none';
        this.prayerTextarea.style.display = display;
        if (this.prayerCheck.checked) {
          // Smooth animation
          this.prayerTextarea.style.opacity = '0';
          this.prayerTextarea.style.transform = 'translateY(-10px)';
          setTimeout(() => {
            this.prayerTextarea.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
            this.prayerTextarea.style.opacity = '1';
            this.prayerTextarea.style.transform = 'translateY(0)';
          }, 10);
        }
      }
      submitEmotion() {
        const emotionData = {
          emotionLevel: parseInt(this.slider.value),
          emotionType: this.getCurrentEmotionType(),
          prayerRequest: this.prayerCheck.checked,
          prayerDescription: this.prayerCheck.checked ?
            document.getElementById('prayerDescription').value : '',
          isAnonymous: document.getElementById('anonymousRequest').checked,
          timestamp: new Date().toISOString()
        };
        // Simular envío de datos al servidor
        console.log('Datos de emoción enviados:', emotionData);
        // Mostrar confirmación
        this.showSubmissionConfirmation();
        // Cerrar modal después de un momento
        setTimeout(() => {
          const modal = bootstrap.Modal.getInstance(document.getElementById('emotionModal'));
          modal.hide();
          this.resetForm();
        }, 2500);
      }
      getCurrentEmotionType() {
        const value = parseInt(this.slider.value);
        if (value >= 1 && value <= 35) {
          return 'happy';   // Verde = Bien
        } else if (value >= 36 && value <= 65) {
          return 'neutral'; // Amarillo = Normal
        } else if (value >= 66 && value <= 100) {
          return 'sad';     // Rojo = Mal
        }
        return 'neutral';
      }
      showSubmissionConfirmation() {
        const originalText = this.submitBtn.textContent;
        this.submitBtn.innerHTML = '<i class="fas fa-check"></i> ¡Gracias por compartir!';
        this.submitBtn.style.background = 'linear-gradient(135deg, #22c55e, #16a34a)';
        this.submitBtn.disabled = true;              // Feedback visual adicional
        const modalBody = this.submitBtn.closest('.modal-body');
        const successMessage = document.createElement('div');
        successMessage.className = 'alert alert-success mt-3';
        successMessage.innerHTML = '<strong>¡Éxito!</strong> Tu estado emocional ha sido registrado. Que Dios te bendiga.';
        modalBody.appendChild(successMessage);
        setTimeout(() => {
          this.submitBtn.textContent = originalText;
          this.submitBtn.style.background = 'linear-gradient(135deg, #3b82f6, #2563eb)';
          this.submitBtn.disabled = false;
          if (successMessage.parentNode) {
            successMessage.remove();
          }
        }, 2500);
      }
      resetForm() {
        this.slider.value = 50;
        this.prayerCheck.checked = false;
        document.getElementById('prayerDescription').value = '';
        document.getElementById('anonymousRequest').checked = false;
        this.prayerTextarea.style.display = 'none';
        this.updateEmotion();
      }
    }
    // Initialize when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      // Multiple Slider
      var splideMultiple = new Splide( '.splide-multiple', {
          perPage: 3,
          rewind : true,
      } );
      splideMultiple.mount();
      new EmotionMeter();
      // Auto-mostrar modal al cargar la página
      setTimeout(() => {
        const modal = new bootstrap.Modal(document.getElementById('emotionModal'), {
          backdrop: 'static',  // Evita cerrar al hacer clic fuera
          keyboard: false      // Evita cerrar con la tecla Esc
        });
        modal.show();
      }, 500); // Pequeño retraso para mejor experiencia visual
    });
    // Manejar cierre del modal
    document.getElementById('emotionModal').addEventListener('hidden.bs.modal', function () {
      console.log('Modal cerrado');
      // Aquí podrías redirigir a otra página o realizar alguna acción
    });
  </script>
<!--  END *** SCRIPTS ***  -->
</body>
</html>
