<%
  const LOCAL_PAGE = Object.freeze({
    description: {
      en: '',
      es: ''
    },
    keywords: {
      en: '',
      es: ''
    },
    robots: 'index, follow',
    canonical: '',
    og_url: '',
    og_site_name: {
      en: '',
      es: ''
    },
    og_image: '',
    twitter_card: {
      en: '',
      es: ''
    },
    stylesheets: [
      "/ministry/res/src/plugins/src/table/datatable/datatables.css",
      "/ministry/res/src/plugins/css/light/table/datatable/dt-global_style.css",
      "/ministry/res/src/plugins/css/dark/table/datatable/dt-global_style.css"
    ]
  })
%>

<%- include('./header-page-logged.ejs', {
  LOCAL_PAGE
}) -%>
<!--  BEGIN *** CONTENT ***  -->
  <div class="row layout-top-spacing">
  <div class="col-xl-12 col-lg-12 col-sm-12  layout-spacing">
    <div class="col-xl-12 col-lg-12 col-md-6 col-sm-12 col-12 layout-spacing">
      <div class="widget widget-five">
        <div class="widget-heading">
          <a href="javascript:void(0)" class="task-info">
            <div class="usr-avatar">
                <span>RO</span>
            </div>
            <div class="w-title">
                <h4><%=LOCAL_STRINGS.list_departments[language]%></h4>
            </div>
          </a>
          <div class="task-action">
            <div class="dropdown d-inline-block">
              <a class="dropdown-toggle" href="#" role="button" id="elementDrodpown3" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-horizontal"><circle cx="12" cy="12" r="1"></circle><circle cx="19" cy="12" r="1"></circle><circle cx="5" cy="12" r="1"></circle></svg>
              </a>
              <div class="dropdown-menu right" aria-labelledby="elementDrodpown2" style="will-change: transform; position: absolute; transform: translate3d(-141px, 19px, 0px); top: 0px; left: 0px;">
                <a class="dropdown-item" href="/ministry/admin/organizations-departments-new">
                  <div class="icon-container">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus-circle"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line></svg>
                    <span class="icon-name"><%=LOCAL_STRINGS.add[language]%></span>
                  </div>
                </a>
                <a class="dropdown-item" href="javascript:void(0);">
                  <div class="icon-container">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-security"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
                    <span class="icon-name"><%=LOCAL_STRINGS.security[language]%></span>
                  </div>
                </a>
                <a class="dropdown-item" href="javascript:void(0);">
                  <div class="icon-container">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-share"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path><polyline points="16 6 12 2 8 6"></polyline><line x1="12" y1="2" x2="12" y2="15"></line></svg>
                    <span class="icon-name"> <%=LOCAL_STRINGS.share[language]%></span>
                  </div>
                </a>
                <a class="dropdown-item" href="javascript:void(0);">
                  <div class="icon-container">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-printer"><polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect></svg>
                    <span class="icon-name"><%=LOCAL_STRINGS.print[language]%></span>
                  </div>
                </a>
                <a class="dropdown-item" href="javascript:void(0);">
                  <div class="icon-container">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-download"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                    <span class="icon-name"><%=LOCAL_STRINGS.download[language]%></span>
                  </div>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="panel_seccion_add" class="widget-content widget-content-area br-8">
    </div>
    <div id="panel_listado" class="widget-content widget-content-area br-8">
      <%
      if (!departments.length)
      {%>
        <div class="alert alert-warning">
          <strong><%=LOCAL_STRINGS.without_departments[language]%></strong>
        </div>
      <%} else {%>
        <div id="ecommerce-list_wrapper" class="dataTables_wrapper container-fluid dt-bootstrap4 no-footer">
          <div class="dt--top-section">
            <div class="row">
              <div class="col-12 col-sm-6 d-flex justify-content-sm-start justify-content-center">
                <div class="dataTables_length" id="ecommerce-list_length">
                  <label><%=LOCAL_STRINGS.items_per_page[language]%>:
                    <select name="ecommerce-list_length" aria-controls="ecommerce-list" class="form-control">
                      <option value="10">10</option>
                      <option value="20" selected="selected">20</option>
                      <option value="50">50</option>
                      <option value="100">100</option>
                    </select>
                  </label>
                </div>
              </div>
              <div class="col-12 col-sm-6 d-flex justify-content-sm-end justify-content-center mt-sm-0 mt-3">
                <div id="ecommerce-list_filter" class="dataTables_filter">
                  <label>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
                      <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                    <input type="search" class="form-control" placeholder="Search..." aria-controls="ecommerce-list">
                  </label>
                </div>
              </div>
            </div>
          </div>
          <div class="table-responsive">
            <table id="ecommerce-list"  class="table dt-table-hover dataTable no-footer" style="width: 100%;" role="grid" aria-describedby="ecommerce-list_info">
              <thead>
                  <tr>
                      <th class="checkbox-column">ID</th>
                      <th><%=LOCAL_STRINGS.departments[language]%></th>
                      <th><%=LOCAL_STRINGS.responsible[language]%></th>
                      <th><%=LOCAL_STRINGS.phone[language]%></th>
                      <th><%=LOCAL_STRINGS.email[language]%></th>
                      <th><%=LOCAL_STRINGS.location[language]%></th>
                      <th><%=LOCAL_STRINGS.status[language]%></th>
                      <th class="no-content text-center"><%=LOCAL_STRINGS.actions[language]%></th>
                  </tr>
              </thead>
              <tbody>
                  <%
                    for (i=0; i<departments.length; i++)
                  {%>
                    <tr>
                      <td>
                        <a href="/ministry/admin/organizations-departments-edit?id=<%=departments[i].id_department%>" title="<%=LOCAL_STRINGS.btn_update[language]%> <%=departments[i].department%>">
                          <%=departments[i].id_department%>
                        </a>
                      </td>
                      <td><h6 class="mb-0"><%=departments[i].department%></h6></td>
                      <td>
                        <div class="media">
                          <div class="avatar me-2">
                            <img alt="avatar" src="/profile/res/src/assets/img/users/<%=departments[i].photo%>" class="rounded-circle" />
                          </div>
                          <div class="media-body align-self-center">
                            <h6 class="mb-0"><%=departments[i].first_name%> <%=departments[i].last_name%></h6>
                            <span><%=departments[i].cell_phone%></span>
                          </div>
                        </div>
                      </td>
                      <td><%=departments[i].phone_department%></td>
                      <td><%=departments[i].email_department%></td>
                      <td>
                        <span class="text-success">
                          <img src="/profile/res/src/assets/img/flag/<%=departments[i].img_flag%>" width="18px" title="<%=departments[i].country%>" alt="<%=departments[i].country%>"> 
                          <%=departments[i].title%>
                        </span><br>
                        <span class="text-secondary">
                          <%=departments[i].room%> -
                          <span class="badge badge-success mb-2 me-4">
                            <% switch(departments[i].room_type) {
                              case 'Office': %>
                                <%=LOCAL_STRINGS.room_type_office[language]%>
                              <% break;
                              case 'Sanctuary': %>
                                <%=LOCAL_STRINGS.room_type_sanctuary[language]%>
                              <% break;
                              case 'Children': %>
                                <%=LOCAL_STRINGS.room_type_children[language]%>
                              <% break;
                              case 'Youth': %>
                                <%=LOCAL_STRINGS.room_type_youth[language]%>
                              <% break;
                              case 'Meeting room': %>
                                <%=LOCAL_STRINGS.room_type_meeting_room[language]%>
                              <% break;
                              case 'Facilities': %>
                                <%=LOCAL_STRINGS.room_type_facilities[language]%>
                              <% break;
                              case 'Pastoral house': %>
                                <%=LOCAL_STRINGS.room_type_pastoral_house[language]%>
                              <% break;
                            }%>
                          </span>
                        </span>
                        <br>
                        <span class="text-secondary"><%=departments[i].address_1%></span>
                        <br>
                        <span class="text-secondary"><%=departments[i].address_2%></span>
                      </td>
                      <td><%=departments[i].active%></td>
                      <td class="text-center">
                        <div class="action-btns">
                          <a href="javascript:void(0);" class="action-btn btn-view bs-tooltip me-2" data-toggle="tooltip" data-placement="top" title="View">
                              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-eye"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                          </a>
                          <a href="/ministry/admin/organizations-departments-edit?id=<%=departments[i].id_department%>"
                            title="<%=LOCAL_STRINGS.btn_update[language]%> <%=departments[i].department%>"
                            class="action-btn btn-edit bs-tooltip me-2" data-toggle="tooltip" data-placement="top" >
                              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg>
                          </a>
                          <a id="anc_delete_departments_<%=departments[i].id_department%>"
                            href="#"
                            title="<%=LOCAL_STRINGS.delete_department[language]%>"
                            class="red"
                            id-department="<%=departments[i].id_department%>"
                            data-ripple=""
                            onclick="anc_delete_departments_click(event)" class="action-btn btn-delete bs-tooltip" data-toggle="tooltip" data-placement="top">
                              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                          </a>
                        </div>
                      </td>
                    </tr>
                  <%}%>
              </tbody>
            </table>
          </div>
          <div class="dt--bottom-section d-sm-flex justify-content-sm-between text-center">
            <div class="dt--pages-count  mb-sm-0 mb-3">
              <div class="dataTables_info" id="ecommerce-list_info" role="status" aria-live="polite">
                <%=LOCAL_STRINGS.total_of_departmens[language]%>: <%=departments[0].total_rows%>
              </div>
            </div>
            <div class="dt--pagination">
              <div class="dataTables_paginate paging_simple_numbers" id="ecommerce-list_paginate">
                <%
                  var iTotalRows = departments[0].total_rows;
                  var iNumPages = Math.trunc(iTotalRows / limit);
                  if ((iTotalRows % limit) != 0) {
                    iNumPages++;
                  }
                  if (iNumPages > 1) {
                    %>
                      <ul class="pagination">
                    <%
                    var iPrevPage = page - 1;
                    if (iPrevPage > 0) {%>
                      <li class="paginate_button page-item previous" id="ecommerce-list_previous">
                        <a href="/ministry/admin/organizations-departments?page=<%=iPrevPage%>" aria-controls="ecommerce-list" data-dt-idx="0" tabindex="0" class="page-link" alt="<%=LOCAL_STRINGS.previous[language]%>">
                          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline>
                          </svg>
                        </a>
                      </li>
                    <%}
                    for (iLoop = 1; iLoop <= iNumPages; iLoop++) {
                      if (iLoop == page) {%>
                        <li class="paginate_button page-item active">
                          <a href="/ministry/admin/organizations-departments?page=<%=iLoop%>" aria-controls="ecommerce-list" data-dt-idx="<%=iLoop%>" tabindex="0" class="page-link"><%=iLoop%></a>
                        </li>
                      <%} else {%>
                        <li class="paginate_button page-item ">
                          <a href="/ministry/admin/organizations-departments?page=<%=iLoop%>" aria-controls="ecommerce-list" data-dt-idx="<%=iLoop%>" tabindex="0" class="page-link"><%=iLoop%></a>
                        </li>
                      <%}
                    }
                    var iNextPage = page + 1;
                    if (iNextPage <= iNumPages) {%>
                      <li class="paginate_button page-item next" id="ecommerce-list_next">
                        <a href="/ministry/admin/organizations-departments?page=<%=iNextPage%>" aria-controls="ecommerce-list" data-dt-idx="<%=iNextPage%>" tabindex="0" class="page-link" alt="<%=LOCAL_STRINGS.next[language]%>">
                          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline>
                          </svg>
                        </a>
                      </li>
                    <%}
                    %>
                      </ul>
                    <%
                  }
                %>
              </div>
            </div>
          </div>
        </div>
      <%}%>
    </div>
  </div>
  <!--  END *** CONTENT ***  -->
  <%- include('./footer-page-logged.ejs'); -%>
  <!--  BEGIN *** SCRIPTS ***  -->
  <script>
    async function anc_delete_departments_click(event) {
			event.preventDefault();
			var oElement = event.currentTarget;
			console.log("id-department:  " + parseInt(oElement.getAttribute('id-department')));
			Swal.fire({
				title: "<%=LOCAL_STRINGS.delete_this_department[language]%>",
				text: "",
				icon: "warning",
				showCancelButton: true,
				confirmButtonClass: "btn-danger",
				confirmButtonText: "<%=LOCAL_STRINGS.yes[language]%>",
				cancelButtonText: "<%=LOCAL_STRINGS.no[language]%>",
				closeOnConfirm: false,
				closeOnCancel: false
			}).then( async (bAction) => {
				if (bAction.value == true) {
					const oFetch = await fetch('/ministry/admin/organizations-departments-delete', {
						method: 'POST',
						headers: {
							'Content-Type': 'application/json'
						},
						body: JSON.stringify({
							id_department: parseInt(oElement.getAttribute('id-department'))
						})
					});
					let oValue = await oFetch.json();
          console.log('code:' + oValue.message.code)
          if (oValue.message.code === 'completed_operation') {
            Swal.fire({
              title: '<%=LOCAL_STRINGS.department_deleted[language]%>',
              text: '',
              icon: 'success',
              confirmButtonText: '<%=LOCAL_STRINGS.ok[language]%>',
              width: 'auto',
              allowOutsideClick: false,
              allowEscapeKey: false
            }).then((bAction) => {
              window.location.replace('/ministry/admin/organizations-departments');
              return;
            });
          } else {
            Swal.fire({
              title: oValue.message['<%=language%>'],
              text: '',
              icon: 'error',
              confirmButtonText: '<%=LOCAL_STRINGS.ok[language]%>',
              width: 'auto',
              allowOutsideClick: false,
              allowEscapeKey: false
            }).then((bAction) => {
              icoUpdate.classList.add('d-none');
              return;
            });
          }
				}
			});
		}
  </script>
  <!--  END *** SCRIPTS ***  -->
</body>
</html>
